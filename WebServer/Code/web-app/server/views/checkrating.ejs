<html lang="ko">

<head>
    <%- include('head.ejs'); %>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>
</head>
<body style="text-align: center;">
    <%- include('header.ejs'); %>
    <% if(session.userid) { %>
        <a href="/logout" class="">로그아웃</a>&nbsp;
    <% } else { %>
        <script>location.replace('/');</script>
    <% } %>
    <div class="posts">
        <h1>Get the Current Poll Standings</h1>
        <!--button onclick="checkpoll()">Check Poll</button-->
        <label>투표율<div id="test" style="font-size:50px;"></div></label>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        checkpoll();
    })
    var cnt = 0;
    var total = 10; //총 학생수
    var checkpoll = function(){
        $.ajax({
            url:'/getCurrentStanding',
            success:function(data){
                var jsonfile = {
                    "jsonarray": JSON.parse(data)
                };
                var labels = jsonfile.jsonarray.map(function(e) {
                    console.log(e.Key);
                    if(e.Record.ballotCast){
                        cnt++;
                    }
                });
                $('#test').html(cnt/total * 100 + '%');   
            }
        })
    }
</script>
</body>